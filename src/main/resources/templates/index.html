<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager Pro</title>
    <link rel="stylesheet" th:href="@{/styles.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-12">
            <!-- Header -->
            <div class="card header-card mb-4">
                <div class="card-body text-center text-white">
                    <h1 class="display-6 mb-2"><i class="fas fa-tasks me-2"></i>Task Manager Pro</h1>
                    <p class="mb-0">Organize your life, one task at a time</p>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card stat-card bg-primary text-white">
                        <div class="card-body text-center">
                            <h4><i class="fas fa-list-check"></i></h4>
                            <h5 th:text="${totalTasks != null ? totalTasks : '0'}">0</h5>
                            <small>Total Tasks</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card stat-card bg-warning text-white">
                        <div class="card-body text-center">
                            <h4><i class="fas fa-clock"></i></h4>
                            <h5 th:text="${activeTasks != null ? activeTasks : '0'}">0</h5>
                            <small>Active Tasks</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card stat-card bg-success text-white">
                        <div class="card-body text-center">
                            <h4><i class="fas fa-check-circle"></i></h4>
                            <h5 th:text="${completedTasksCount != null ? completedTasksCount : '0'}">0</h5>
                            <small>Completed</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card stat-card bg-info text-white">
                        <div class="card-body text-center">
                            <h4><i class="fas fa-calendar-day"></i></h4>
                            <h5 th:text="${todayTasks != null ? todayTasks : '0'}">0</h5>
                            <small>Due Today</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Add Task Form -->
            <div class="card form-card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-plus-circle me-2"></i>Add New Task</h5>
                </div>
                <div class="card-body">
                    <form th:action="@{/add}" method="post" class="row g-3">
                        <div class="col-md-3">
                            <input type="text" class="form-control" name="title"
                                   placeholder="Task title" required>
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control" name="description"
                                   placeholder="Description">
                        </div>
                        <div class="col-md-2">
                            <input type="date" class="form-control" name="dueDate" id="dueDate">
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" name="category">
                                <option value="PERSONAL">üìù Personal</option>
                                <option value="WORK">üíº Work</option>
                                <option value="SHOPPING">üõí Shopping</option>
                                <option value="HEALTH">üè• Health</option>
                                <option value="EDUCATION">üìö Education</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" name="priority">
                                <option value="LOW">üü¢ Low</option>
                                <option value="MEDIUM" selected>üü° Medium</option>
                                <option value="HIGH">üü† High</option>
                                <option value="URGENT">üî¥ Urgent</option>
                            </select>
                        </div>
                        <div class="col-md-1">
                            <button type="submit" class="btn btn-success w-100">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Filter and Search Section -->
            <div class="card filter-card mb-4">
                <div class="card-body">
                    <div class="row g-3 align-items-center">
                        <div class="col-md-4">
                            <label class="form-label small text-muted">Filter by Category:</label>
                            <select class="form-select" id="categoryFilter" onchange="filterTasks()">
                                <option value="ALL">All Categories</option>
                                <option value="PERSONAL">Personal</option>
                                <option value="WORK">Work</option>
                                <option value="SHOPPING">Shopping</option>
                                <option value="HEALTH">Health</option>
                                <option value="EDUCATION">Education</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small text-muted">Filter by Priority:</label>
                            <select class="form-select" id="priorityFilter" onchange="filterTasks()">
                                <option value="ALL">All Priorities</option>
                                <option value="URGENT">Urgent</option>
                                <option value="HIGH">High</option>
                                <option value="MEDIUM">Medium</option>
                                <option value="LOW">Low</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small text-muted">Search Tasks:</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="searchInput"
                                       placeholder="Search tasks...">
                                <button class="btn btn-outline-primary" onclick="filterTasks()">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Active Tasks Section -->
            <div class="card tasks-card mb-4">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                        <i class="fas fa-clock me-2"></i>Active Tasks
                        <span class="badge bg-dark ms-2" th:text="${tasks.size()}">0</span>
                    </h5>
                </div>
                <div class="card-body">
                    <div th:if="${tasks.empty}">
                        <div class="text-center py-4">
                            <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                            <h5 class="text-muted">No active tasks!</h5>
                            <p class="text-muted">Add a new task to get started.</p>
                        </div>
                    </div>

                    <div th:each="task : ${tasks}" class="task-card card mb-3 priority-${task.priority}">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <div class="d-flex align-items-start">
                                        <div class="me-3">
                                                <span class="category-icon">
                                                    <i th:switch="${task.category}">
                                                        <i th:case="PERSONAL" class="fas fa-user text-primary"></i>
                                                        <i th:case="WORK" class="fas fa-briefcase text-info"></i>
                                                        <i th:case="SHOPPING" class="fas fa-shopping-cart text-success"></i>
                                                        <i th:case="HEALTH" class="fas fa-heartbeat text-danger"></i>
                                                        <i th:case="EDUCATION" class="fas fa-graduation-cap text-warning"></i>
                                                    </i>
                                                </span>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h5 class="mb-1" th:text="${task.title}"></h5>
                                            <p th:if="${task.description}" th:text="${task.description}"
                                               class="text-muted mb-1"></p>
                                            <div class="task-meta">
                                                <!-- In the task display section, find this part: -->
                                                <small th:if="${task.dueDate}"
                                                       th:classappend="${task.dueDate != null and task.dueDate.isBefore(T(java.time.LocalDate).now())} ? 'text-danger' : 'text-info'"
                                                       th:text="'üìÖ ' + ${task.dueDate}">
                                                </small>
                                                <span class="badge category-badge ms-2"
                                                      th:classappend="${task.category}">
                                                        <span th:text="${task.category}"></span>
                                                    </span>
                                                <span class="badge priority-badge ms-1"
                                                      th:classappend="${task.priority}">
                                                        <span th:text="${task.priority}"></span>
                                                    </span>
                                                <small class="text-muted ms-2">
                                                    <i class="fas fa-calendar-plus"></i>
                                                    <span th:text="' ' + ${#temporals.format(task.createdAt, 'MMM dd')}"></span>
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 text-end">
                                    <div class="btn-group" role="group">
                                        <a th:href="@{/edit/{id}(id=${task.id})}" class="btn btn-primary btn-sm">
                                            <i class="fas fa-edit"></i> Edit
                                        </a>
                                        <form th:action="@{/complete/{id}(id=${task.id})}"
                                              method="post" class="d-inline">
                                            <button type="submit" class="btn btn-success btn-sm">
                                                <i class="fas fa-check"></i> Complete
                                            </button>
                                        </form>
                                        <form th:action="@{/delete/{id}(id=${task.id})}"
                                              method="post" class="d-inline">
                                            <button type="submit" class="btn btn-danger btn-sm"
                                                    onclick="return confirm('Are you sure you want to delete this task?')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Completed Tasks Section -->
            <div th:if="${not completedTasks.empty}">
                <div class="card completed-card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-check-circle me-2"></i>Completed Tasks
                            <span class="badge bg-light text-dark ms-2" th:text="${completedTasks.size()}">0</span>
                        </h5>
                    </div>
                    <div class="card-body">
                        <div th:each="task : ${completedTasks}" class="card mb-2 border-success completed-task">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <div class="d-flex align-items-center">
                                            <div class="me-3">
                                                <i class="fas fa-check-circle text-success"></i>
                                            </div>
                                            <div>
                                                <h6 class="mb-1 text-success text-decoration-line-through"
                                                    th:text="${task.title}"></h6>
                                                <p th:if="${task.description}" th:text="${task.description}"
                                                   class="text-muted mb-0 small"></p>
                                                <div class="task-meta">
                                                    <small class="text-muted">
                                                        Completed on <span th:text="${#temporals.format(task.createdAt, 'MMM dd, yyyy')}"></span>
                                                    </small>
                                                    <span class="badge bg-secondary ms-2" th:text="${task.category}"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <div class="btn-group">
                                            <form th:action="@{/reopen/{id}(id=${task.id})}" method="post" class="d-inline">
                                                <button type="submit" class="btn btn-outline-warning btn-sm">
                                                    <i class="fas fa-undo"></i> Reopen
                                                </button>
                                            </form>
                                            <form th:action="@{/delete/{id}(id=${task.id})}" method="post" class="d-inline">
                                                <button type="submit" class="btn btn-outline-danger btn-sm"
                                                        onclick="return confirm('Delete this completed task?')">
                                                    <i class="fas fa-trash"></i> Delete
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Simple filtering function
    function filterTasks() {
        const categoryFilter = document.getElementById('categoryFilter').value;
        const priorityFilter = document.getElementById('priorityFilter').value;
        const searchText = document.getElementById('searchInput').value.toLowerCase();

        const taskCards = document.querySelectorAll('.task-card');

        taskCards.forEach(card => {
            const category = card.querySelector('.category-badge').textContent;
            const priority = card.querySelector('.priority-badge').textContent;
            const title = card.querySelector('h5').textContent.toLowerCase();
            const description = card.querySelector('p') ? card.querySelector('p').textContent.toLowerCase() : '';

            const categoryMatch = categoryFilter === 'ALL' || category === categoryFilter;
            const priorityMatch = priorityFilter === 'ALL' || priority === priorityFilter;
            const searchMatch = title.includes(searchText) || description.includes(searchText);

            if (categoryMatch && priorityMatch && searchMatch) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }

    // Set minimum date to today for due date
    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date().toISOString().split('T')[0];
        const dueDateInput = document.getElementById('dueDate');
        if (dueDateInput) {
            dueDateInput.min = today;
        }

        // Add event listener for search input
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    filterTasks();
                }
            });
        }
    });

    // Simple confirmation for delete actions
    function confirmDelete() {
        return confirm('Are you sure you want to delete this task?');
    }
</script>
</body>
</html>